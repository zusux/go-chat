(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1107326e"],{"1b51":function(s,e,t){},"4a26":function(s,e,t){},"6f29":function(s,e,t){"use strict";t.r(e);var i=function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",{staticClass:"box"},[t("div",{staticClass:"left"},[t("div",{staticClass:"my-info"},[""!=s.userImg?t("img",{attrs:{src:s.userImg,alt:""}}):s._e(),t("span",{staticClass:"my-name"},[s._v(s._s(s.username))])]),t("div",{staticClass:"search"},[t("div",{staticClass:"item"},[t("el-input",{attrs:{placeholder:"请输入内容","prefix-icon":"el-icon-search"},on:{change:s.filterUser},model:{value:s.findUser,callback:function(e){s.findUser=e},expression:"findUser"}})],1),t("div",{staticClass:"list"},s._l(s.users,(function(e){return t("div",{key:e.userId,staticClass:"item",class:{active:s.activeUserId==e.userId},attrs:{"user-id":e.userId},on:{click:function(t){return s.selectUser(e.userId)}}},[t("div",{staticClass:"item-left"},[t("img",{attrs:{src:e.img,alt:""}})]),t("div",{staticClass:"item-center"},[t("div",{staticClass:"item-wrap"},[t("div",{staticClass:"title"},[t("div",{staticClass:"name"},[s._v(s._s(e.name))]),t("div",{staticClass:"time"},[s._v(s._s(e.time))])]),t("div",{staticClass:"content"},[s._v(s._s(e.content))])])])])})),0)])]),t("div",{staticClass:"right"},[t("div",{staticClass:"show-msg"},[t("div",{staticClass:"show-box"},[t("div",{staticClass:"msg-list"},s._l(s.activeMessage,(function(e,i){return t("div",{key:i,staticClass:"msg-item ",class:{"position-right":s.myUserId==e.userId}},[t("div",{staticClass:"msg-left"},[t("img",{attrs:{src:e.img,alt:""}})]),t("div",{staticClass:"msg-right"},[t("div",{staticClass:"user-name"},[s._v(s._s(e.name))]),t("div",{staticClass:"msg-content"},[s._v(s._s(e.content))])])])})),0)])]),t("div",{staticClass:"send-msg"},[t("el-input",{staticClass:"textareaBox",attrs:{type:"textarea",placeholder:"请输入内容"},model:{value:s.sendMsgContent,callback:function(e){s.sendMsgContent=e},expression:"sendMsgContent"}}),t("el-button",{staticClass:"send-button",on:{click:s.doSend}},[s._v("发送(S)")])],1)]),t("el-dialog",{attrs:{title:"设置信息",visible:s.dialogFormVisible,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){s.dialogFormVisible=e}}},[t("el-form",[t("div",s._l(s.imglist,(function(e){return t("span",{class:{"img-active":s.userImg==e},staticStyle:{width:"43px",height:"43px",display:"inline-block","margin-right":"10px",border:"1px solid transparent"}},[t("img",{staticStyle:{width:"41px",height:"41px"},attrs:{src:e,alt:""},on:{click:function(t){return s.selectImg(e)}}})])})),0),t("el-form-item",{attrs:{label:"姓名"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:s.username,callback:function(e){s.username=e},expression:"username"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:s.setUserinfo}},[s._v("确 定")])],1)],1)],1)},a=[],n=(t("a434"),{name:"index",data:function(){return{dialogFormVisible:!0,imglist:["/static/img/1.jpg","/static/img/2.jpg","/static/img/3.jpg"],conn:null,myUserId:"",username:"",userImg:"",activeUserId:"",sendMsgContent:"",users:{},findUser:"",activeMessage:[],messages:{}}},created:function(){this.conn=new WebSocket("ws://localhost:9999/wsPage"),this.conn.onclose=this.close,this.conn.onmessage=this.message,this.dialogFormVisible=!0},mounted:function(){},methods:{selectUser:function(s){this.activeUserId=s,this.messages.hasOwnProperty(s)?this.activeMessage=this.messages[s]:this.activeMessage=[]},filterUser:function(){},close:function(){this.$alert("连接已经关闭","连接关闭",{confirmButtonText:"确定",callback:function(s){}})},message:function(s){var e=JSON.parse(s.data);switch(e.action){case"registor":if(e.data.hasOwnProperty("uid")&&(console.log("获取uid",e.data["uid"]),this.myUserId=e.data["uid"]),e.data.hasOwnProperty("users")&&(this.users=e.data["users"],console.log("获取users",e.data["users"])),e.data.hasOwnProperty("user")){var t=e.data["user"];t.userId!==this.myUserId&&this.users.push(t)}break;case"unregistor":if(e.data.hasOwnProperty("user")){var i=e.data["user"];for(var a in this.users)this.users[a].userId==i.userId&&this.users.splice(a,1)}break;default:var n=e.message.content,r=e.message.from_user,c=e.message.from_user_img,o=e.message.username,l={userId:r,img:c,name:o,content:n};this.messages.hasOwnProperty(r)?this.messages[r].push(l):this.messages[r]=[l],this.activeUserId==r&&(this.activeMessage=this.messages[r]);break}},sendMsg:function(s){var e={action:"message",data:{},message:{from_user:this.myUserId,from_user_img:this.userImg,username:this.username,to_user:this.activeUserId,msg_code:0,content:s}};this.conn.send(JSON.stringify(e));var t={userId:this.myUserId,content:s,name:this.username,img:this.userImg};this.messages.hasOwnProperty(this.activeUserId)?this.messages[this.activeUserId].push(t):this.messages[this.activeUserId]=[t],this.activeMessage=this.messages[this.activeUserId]},doSend:function(){""!==this.sendMsgContent&&this.sendMsg(this.sendMsgContent),this.sendMsgContent=""},selectImg:function(s){this.userImg=s},setUserinfo:function(){if(""!=this.userImg)if(""!=this.username){var s={action:"set",data:{username:this.username,img:this.userImg},message:{}};this.conn.send(JSON.stringify(s)),this.dialogFormVisible=!1}else this.$message.warning("请设置用户名");else this.$message.warning("请设置头像")}}}),r=n,c=(t("950f"),t("8b88"),t("2877")),o=Object(c["a"])(r,i,a,!1,null,"1fa6741a",null);e["default"]=o.exports},"8b88":function(s,e,t){"use strict";var i=t("4a26"),a=t.n(i);a.a},"950f":function(s,e,t){"use strict";var i=t("1b51"),a=t.n(i);a.a}}]);